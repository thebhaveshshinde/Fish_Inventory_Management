<template>
  <main>
    <nav class="fixed top-0 left-0 right-0 w-full flex justify-between z-10 p-4">
      <div>
        <svg width="80" height="21" viewBox="0 0 80 21" fill="black" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M66.2071 20.1481C67.3839 20.1452 67.9079 20.0211 67.9079 20.0211C67.9079 20.0211 67.5703 18.6945 67.5059 17.8984C67.4415 17.1022 67.4049 16.6875 67.5059 15.5985C67.6019 14.5669 67.7627 12.6936 68.4589 12.2454C69.0693 11.8523 71.2066 10.9551 71.7648 10.6015C72.3229 10.2479 74.1265 8.92101 74.4911 8.63357C74.8561 8.34614 76.8532 6.82038 77.4114 6.13524C77.9695 5.45009 78.2054 5.25087 78.549 4.58742C78.8927 3.92433 79.1072 2.84076 79.1072 2.35411C79.1072 1.86782 79.1072 0.806297 78.9567 0.430639C78.8066 0.0546254 78.7635 -0.0335972 78.4629 0.0105142C78.1623 0.0546255 78.2481 -0.0339531 78.0553 0.364116C77.8617 0.762186 77.6903 1.40322 77.3466 1.58038C77.003 1.75718 73.3531 2.17731 72.0006 2.77423C70.6481 3.37116 69.514 3.93429 68.0071 5.0296C66.9122 5.82539 66.0538 7.28498 66.0538 7.28498L66.042 7.26612C66.042 7.26612 65.1947 5.82574 64.1001 5.0296C62.5935 3.93429 61.4591 3.37116 60.1062 2.77423C58.7537 2.17731 55.1038 1.75718 54.7605 1.58038C54.4165 1.40322 54.2451 0.762186 54.0519 0.364116C53.8587 -0.0339531 53.9445 0.0546255 53.6442 0.0105142C53.3433 -0.033953 53.3006 0.0546254 53.1501 0.430639C53 0.806653 53 1.86782 53 2.35411C53 2.84076 53.2149 3.92433 53.5578 4.58742C53.9014 5.25087 54.1376 5.44973 54.6958 6.13524C55.2539 6.82074 57.2511 8.34614 57.6157 8.63357C57.9807 8.92101 59.7843 10.2479 60.3424 10.6015C60.9006 10.9551 63.0375 11.8523 63.6483 12.2454C64.3444 12.6936 64.7646 14.5666 64.8535 15.5985C64.9528 16.7554 64.9179 17.1022 64.8535 17.8984C64.7891 18.6945 64.5205 20.0598 64.5205 20.0598C64.5205 20.0598 65.1794 20.1491 66.2071 20.1481Z"
            fill="black" />
          <path
            d="M9.4288 0.237089C9.56925 0.237089 9.71848 0.307254 9.8765 0.447709C10.0345 0.588163 10.1135 0.763756 10.1135 0.974455V4.42465H8.98103C8.61231 4.42465 8.2831 4.33687 7.99338 4.16127C7.70367 3.98568 7.51491 3.81889 7.42713 3.66086C7.37446 3.57308 7.30861 3.49407 7.2296 3.42383C7.15059 3.35359 7.0145 3.31848 6.82137 3.31848H4.92508C4.80217 3.31848 4.69682 3.35799 4.60904 3.437C4.52125 3.51601 4.47735 3.60819 4.47735 3.71354V8.11188C4.47735 8.2699 4.52125 8.37525 4.60904 8.42792C4.69682 8.4806 4.81094 8.50694 4.95139 8.50694H8.13821C8.27867 8.50694 8.37525 8.61229 8.42792 8.82298C8.4806 9.03368 8.50694 9.20048 8.50694 9.32339V10.9826C8.50694 11.2285 8.39282 11.3514 8.16455 11.3514H4.87238C4.7846 11.3514 4.69682 11.3865 4.60904 11.4567C4.52125 11.527 4.47735 11.6235 4.47735 11.7465V16.4872C4.47735 16.6803 4.50369 16.812 4.55636 16.8822C4.60904 16.9525 4.67928 17.0139 4.76706 17.0666C4.90752 17.1719 5.0436 17.3212 5.17529 17.5143C5.30698 17.7075 5.37282 17.9533 5.37282 18.2518V19.911H0V18.2518C0 17.9533 0.0702417 17.7075 0.210699 17.5143C0.351156 17.3212 0.491613 17.1719 0.63207 17.0666C0.702312 17.0139 0.759385 16.9613 0.803289 16.9086C0.847193 16.8559 0.877929 16.7593 0.895496 16.6189V3.68723C0.895496 3.40629 0.790147 3.22193 0.579448 3.13414C0.403857 3.04636 0.2634 2.9059 0.15805 2.71277C0.0527011 2.51964 2.63731e-05 2.22116 2.63731e-05 1.81733V0.237089H9.4288ZM16.0921 16.5136C16.0921 16.7067 16.1185 16.8384 16.1712 16.9086C16.2238 16.9789 16.2853 17.0403 16.3555 17.093C16.496 17.1983 16.6364 17.3476 16.7769 17.5407C16.9173 17.7339 16.9876 17.9797 16.9876 18.2781V19.9374H11.5884V18.2781C11.5884 17.9797 11.6587 17.7339 11.7991 17.5407C11.9396 17.3476 12.08 17.1983 12.2205 17.093C12.3083 17.0403 12.3741 16.9789 12.418 16.9086C12.4619 16.8384 12.4839 16.7067 12.4839 16.5136V3.68728V3.66094C12.4839 3.48535 12.4619 3.36244 12.418 3.29219C12.3741 3.22195 12.3083 3.15171 12.2205 3.08147C12.08 2.97612 11.9396 2.82687 11.7991 2.63373C11.6587 2.4406 11.5884 2.1948 11.5884 1.89632V0.237062H16.9876V1.89632C16.9876 2.1948 16.9173 2.4406 16.7769 2.63373C16.6364 2.82687 16.496 2.97612 16.3555 3.08147C16.2853 3.15171 16.2238 3.22195 16.1712 3.29219C16.1185 3.36244 16.0921 3.48535 16.0921 3.66094V3.68728V16.5136ZM22.4921 6.13665C22.4921 6.48781 22.6546 6.8082 22.9794 7.09791C23.3042 7.38762 23.7124 7.67734 24.2041 7.96705C24.6957 8.25676 25.2225 8.55964 25.7843 8.87569C26.3462 9.19173 26.8729 9.55169 27.3646 9.95552C27.8562 10.3593 28.2644 10.8203 28.5892 11.3382C28.9141 11.8562 29.0765 12.4664 29.0765 13.1687V16.1975C29.0765 16.8647 28.9229 17.4485 28.6156 17.9489C28.3083 18.4493 27.9088 18.8619 27.4172 19.1868C26.9256 19.5116 26.3681 19.753 25.7448 19.911C25.1215 20.0691 24.485 20.1481 23.8353 20.1481C23.1857 20.1481 22.5448 20.0691 21.9127 19.911C21.2806 19.753 20.7187 19.5116 20.2271 19.1868C19.7355 18.8619 19.3404 18.4493 19.0419 17.9489C18.7434 17.4485 18.5942 16.8647 18.5942 16.1975V13.9588H20.7539C21.2279 13.9588 21.5835 14.1036 21.8205 14.3934C22.0576 14.6831 22.1761 15.0299 22.1761 15.4337V15.9604C22.1761 16.2414 22.3385 16.4872 22.6633 16.6979C22.9881 16.9086 23.3788 17.0139 23.8353 17.0139C24.2918 17.0139 24.6737 16.8866 24.981 16.632C25.2882 16.3774 25.4419 16.1272 25.4419 15.8814V13.8271C25.4419 13.2477 25.2795 12.7692 24.9546 12.3917C24.6298 12.0142 24.226 11.6806 23.7431 11.3909C23.2603 11.1012 22.7336 10.8246 22.1629 10.5613C21.5922 10.2979 21.0655 9.97745 20.5827 9.59996C20.0998 9.22247 19.696 8.76596 19.3712 8.23042C19.0464 7.69488 18.8839 7.01453 18.8839 6.18928V3.97694C18.8839 3.2746 19.02 2.67324 19.2922 2.17283C19.5643 1.67242 19.9286 1.25979 20.3851 0.934976C20.8416 0.610157 21.3684 0.373121 21.9654 0.223868C22.5624 0.0746138 23.1857 0 23.8353 0C24.485 0 25.1083 0.0834104 25.7053 0.250205C26.3022 0.416999 26.8246 0.662806 27.2723 0.987624C27.7201 1.31244 28.0756 1.72507 28.339 2.22548C28.6024 2.72589 28.7341 3.30971 28.7341 3.97691V6.18925H26.7588C26.3198 6.18925 25.9511 6.05756 25.6526 5.79419C25.3541 5.53082 25.2049 5.18843 25.2049 4.76703V4.21395C25.2049 3.84523 25.06 3.55991 24.7703 3.35798C24.4806 3.15606 24.1601 3.05511 23.809 3.05511C23.4403 3.05511 23.1286 3.16045 22.874 3.37115C22.6194 3.58185 22.4921 3.81889 22.4921 4.08226V6.13665ZM42.1661 16.5136C42.1661 16.7067 42.1925 16.8384 42.2452 16.9086C42.2978 16.9789 42.3593 17.0403 42.4295 17.093C42.57 17.1983 42.7104 17.3476 42.8509 17.5407C42.9913 17.7339 43.0616 17.9797 43.0616 18.2781V19.9374H37.6624V18.2781C37.6624 17.9797 37.7327 17.7339 37.8731 17.5407C38.0136 17.3476 38.154 17.1983 38.2945 17.093C38.3823 17.0403 38.4481 16.9789 38.492 16.9086C38.5359 16.8384 38.5579 16.7067 38.5579 16.5136V11.5885C38.5579 11.3427 38.4262 11.2198 38.1628 11.2198H35.4764C35.2306 11.2198 35.1077 11.3427 35.1077 11.5885V16.5136C35.1077 16.7067 35.1296 16.8384 35.1735 16.9086C35.2174 16.9789 35.2833 17.0403 35.3711 17.093C35.5115 17.1983 35.652 17.3476 35.7924 17.5407C35.9329 17.7339 36.0031 17.9797 36.0031 18.2781V19.9374H30.5776V18.2781C30.5776 17.9797 30.6479 17.7339 30.7883 17.5407C30.9288 17.3476 31.0692 17.1983 31.2097 17.093C31.2975 17.0403 31.3633 16.9789 31.4072 16.9086C31.4511 16.8384 31.4731 16.7067 31.4731 16.5136H31.4994V15.8288V3.66094H31.4731C31.4731 3.48535 31.4511 3.36244 31.4072 3.29219C31.3633 3.22195 31.2975 3.15171 31.2097 3.08147C31.0692 2.97612 30.9288 2.82687 30.7883 2.63373C30.6479 2.4406 30.5776 2.1948 30.5776 1.89632V0.237062H36.0031V1.89632C36.0031 2.1948 35.9329 2.4406 35.7924 2.63373C35.652 2.82687 35.5115 2.97612 35.3711 3.08147C35.2833 3.15171 35.2174 3.22195 35.1735 3.29219C35.1296 3.36244 35.1077 3.48535 35.1077 3.66094V7.74323C35.1077 7.88369 35.1516 7.98027 35.2394 8.03294C35.3271 8.08562 35.4149 8.11196 35.5027 8.11196H38.1891C38.4349 8.11196 38.5578 7.98904 38.5578 7.74323V3.66094C38.5578 3.48535 38.5359 3.36244 38.492 3.29219C38.4481 3.22195 38.3823 3.15171 38.2945 3.08147C38.154 2.97612 38.0136 2.82687 37.8731 2.63373C37.7326 2.4406 37.6624 2.1948 37.6624 1.89632V0.237062H43.0616V1.89632C43.0616 2.1948 42.9913 2.4406 42.8509 2.63373C42.7104 2.82687 42.5699 2.97612 42.4295 3.08147C42.3592 3.15171 42.2978 3.22195 42.2451 3.29219C42.1925 3.36244 42.1661 3.48535 42.1661 3.66094V16.5136Z"
            fill="black" />
        </svg>

      </div>
      <UIcon name="i-heroicons-arrow-right-start-on-rectangle" @click="signOut()" class="text-red-600 w-6 h-6" />
    </nav>
    <slot />

    <footer class="fixed left-0 w-full px-3 bottom-3">
      <div role="tablist" class="flex justify-between bg-white rounded-lg shadow-lg md:h-12">
        <NuxtLink to="/vendors"
          class="flex flex-col items-center justify-center w-2/6 rounded-l-lg md:gap-2 md:flex-row" :class="route.path === '/vendors'
            ? 'bg-white  border-t-4 border-pink-500  text-pink-500'
            : 'bg-gray-700 text-gray-300'
            ">
          <UIcon name="i-heroicons-user" class="w-6 h-6" />
          <span class="block text-lg font-bold">Fisherman</span>
        </NuxtLink>

        <NuxtLink to="/vendors/bills" class="flex flex-col items-center justify-center w-2/6 md:gap-2 md:flex-row"
          :class="route.path === '/vendors/bills'
            ? 'bg-white text-blue-700 border-t-4 border-blue-500'
            : 'bg-gray-700 text-gray-300'
            ">
          <UIcon name="i-heroicons-clipboard-document-check" class="w-6 h-6" />
          <span class="block text-lg font-bold">Bills</span>
        </NuxtLink>

        <NuxtLink to="/vendors/settlements"
          class="flex flex-col items-center justify-center w-2/6 rounded-r-lg md:gap-2 md:flex-row" :class="route.path === '/vendors/settlements'
            ? 'bg-white text-green-700 border-t-4 border-green-500'
            : 'bg-gray-700 text-gray-300'
            ">
          <UIcon name="i-heroicons-document-currency-rupee" class="w-6 h-6" />
          <span class="block text-lg font-bold">Settlements</span>
        </NuxtLink>
      </div>
    </footer>
  </main>
</template>
<script lang="ts" setup>
import { collection } from "firebase/firestore";
import { useRoute } from "vue-router";
import { useCurrentVendor } from "~/utils/composables/useCurrentVendor";
import { useVendors } from "~/utils/composables/useVendors";
const { data: authData, signOut } = useAuth();
const route = useRoute();
const stateVendors = useVendors();
const db = useFirestore();
const vendorsCollection = collection(db, "vendors");
const vendors = useCollection(vendorsCollection).value;
stateVendors.value = vendors as Vendors[];

const currentVendor = stateVendors.value.find(
  (vendor) => vendor.email === authData.value?.user?.email,
);
if (currentVendor) {
  useCurrentVendor().value = currentVendor;
}

function checkUser() {
  if (!authData.value?.user) {
    if (!currentVendor) {
      return navigateTo("/unauthorized");
    }
  }
}


function checkPlan() {
  const today = new Date();
  const lastRenewalDate = currentVendor?.dateOfLastRenewal ? new Date(currentVendor.dateOfLastRenewal.seconds * 1000) : null;
  const plan = currentVendor?.plan;
  if (plan === "monthly") {
    if (lastRenewalDate && (today.getTime() - lastRenewalDate.getTime()) > 30 * 24 * 60 * 60 * 1000) {
      return navigateTo("/subscription-expired");
    }
  } else if (plan === "3months") {
    if (lastRenewalDate && (today.getTime() - lastRenewalDate.getTime()) > 90 * 24 * 60 * 60 * 1000) {
      return navigateTo("/subscription-expired");
    }
  } else if (plan === "yearly") {
    if (lastRenewalDate && (today.getTime() - lastRenewalDate.getTime()) > 365 * 24 * 60 * 60 * 1000) {
      return navigateTo("/subscription-expired");
    }
  }
}


checkUser();
checkPlan();

</script>
